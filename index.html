<html lang='en'>
  <head>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
      integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
      crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
      integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
      crossorigin=""></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>



  </head>
  <body>
    <div class="row marketing">
      <div class="col-lg-3">
        <h2>Search</h2>
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="address" aria-describedby="address" placeholder="Enter address">
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <div id="mapid" style="height:500px;"></div>
      </div>
      <div class="col-lg-9">
        <h2>Table</h2>
        <table id="example">
          <thead>
            <tr><th class="site_name">License ID</th><th>Source System</th><th>Address</th><th>City</th><th>Company</th><th>Antennae</th></tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
    <script>

    	var mymap = L.map('mapid').setView([40.650002, -73.949997], 10);

    	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    		maxZoom: 18,
    		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    		id: 'mapbox.streets'
    	}).addTo(mymap);

    	var popup = L.popup();

    	function onMapClick(e) {
        var lat = e.latlng.lat
        var lng = e.latlng.lng

    		popup
    			.setLatLng(e.latlng)
    			.setContent("You clicked the map at " + lat + ", " + lng)
    			.openOn(mymap);
        $.getJSON( " http://104.236.108.140:3000/licenses/" + lat + "/" + lng, function( data ) {
          var items = [];
          var headers = [
            'license_id',
            'source_system',
            'call_sign',
            'radio_service_description',
            'rollup_status_description',
            'lic_address',
            'lic_city',
            'contact_company',
            'ant_type_desc'
          ]

          for (var x = 0; x < data.data.length; x++) {
            var row = []
            row.push(data.data[x].license_id)
            row.push(data.data[x].source_system)
            row.push(data.data[x].lic_address)
            row.push(data.data[x].lic_city)
            row.push(data.data[x].contact_company)
            row.push(data.data[x].ant_type_desc)
            items.push(row)
          }

          addData(items)
        });
    	}

    	mymap.on('click', onMapClick);
      function addData(items) {
        $("#example").dataTable({
          destroy: true,
          "aaData": items,
          "aoColumnDefs":[{
                "sTitle":"License ID"
              , "aTargets": [ "license_id" ]
          }
          // ,{
          //       "aTargets": [ 1 ]
          //     , "bSortable": false
          //     , "mRender": function ( url, type, full )  {
          //         return  '<a href="'+url+'">' + url + '</a>';
          //     }
          // }
          // ,{
          //       "aTargets":[ 3 ]
          //     , "sType": "date"
          //     , "mRender": function(date, type, full) {
          //         return (full[2] == "Blog")
          //                   ? new Date(date).toDateString()
          //                   : "N/A" ;
          //     }
          // }
          ]
        });
      }
    </script>
  </body>
</html>
